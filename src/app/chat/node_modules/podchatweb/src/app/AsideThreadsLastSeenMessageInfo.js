import React, {useState} from "react";
import {useDispatch} from "react-redux";
import {isGroup, prettifyMessageDate} from "../utils/helpers";

import Container from "../../../Talk-ui-kit/src/container";
import Gap from "../../../Talk-ui-kit/src/gap";
import {Text} from "../../../Talk-ui-kit/src/typography";
import {Button} from "../../../Talk-ui-kit/src/button";
import {
  MdDoneAll,
  MdDone
} from "react-icons/md";

import style from "../../styles/app/AsideThreadsLastSeenMessageInfo.scss";
import {chatAcceptCall, chatCallEnded} from "../actions/chatActions";
import strings from "../constants/localization";
import Cookies from "js-cookie";
import {SHOW_CALL_BUTTON} from "../constants/cookieKeys";
import {SHOW_CALL_BUTTONS_EVENT} from "../constants/callModes";

export default function ({isGroup, isChannel, time, lastMessageVO, draftMessage, isMessageByMe, thread}) {
  const dispatch = useDispatch();
  const {call} = thread;
  const [showCallButtons, setShowCallButtons] = useState(true);
/*  window.addEventListener(SHOW_CALL_BUTTONS_EVENT, e => {
    setShowCallButtons(true)
  });*/
  const onJoinCall = e => {
    e.stopPropagation();
    dispatch(chatAcceptCall(thread.call, false,true, thread));
  }

  return <Container topLeft className={style.AsideThreadsLastSeenMessageInfo}>
    {
      lastMessageVO && !isGroup && !isChannel && isMessageByMe &&
      <>
        {draftMessage ? "" : (
          lastMessageVO?.seen ?
            <MdDoneAll size={style.iconSizeSm} color={style.colorAccent}/> :
            <MdDone size={style.iconSizeSm} color={style.colorAccent}/>
        )}
        <Gap x={3}/>
      </>
    }
    <Text size="xs"
          color="gray">{prettifyMessageDate(time || lastMessageVO?.time)}</Text>
    {
      isGroup && call && showCallButtons && <Button className={style.AsideThreadsLastSeenMessageInfo__JoinCallButton} size="sm" onMouseDown={e=>e.stopPropagation()} onClick={onJoinCall}>{strings.joinCall}</Button>
    }

  </Container>
}